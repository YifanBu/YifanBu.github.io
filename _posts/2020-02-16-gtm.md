---
title: "Google Tag Manager with Google Analytics"
date: 2020-02-16
tags: [Google Analytics, Google Tag Manager]
header:
image:
excerpt: "Web, Data Science"
toc: true
toc_label: "Table of Contents"
toc_sticky: true
toc_icon: "cog"
---

# Introduction

## Tag

A tag is **a piece of code** provided by an organization that is usually intended to **send information** to a system, such as Google Analytics.



## Tag Manager

Tag manager removes the need to put individual tags on your page. Instead it **provides you a container that goes on the page**, which can **simplify the tag implementation** and management process for marketers, analysts, and developers.

Google Tag Manager does not store any data, the data gets passed to the tag.

## How GTM Works

### Trigger

In Google Tag Manager, **tags fire based on events**, such as when a form is submitted or when a video is played. **Triggers are used to listen for these events**, and they govern when a tag is fired or blocked.

### Variables

Tag Manager variables are used in both triggers and tags:

- **Variables in triggers** are used to define filters that specify when a particular tag should fire.
Example: Fire a pageview trigger when the url variable is “example.com/index.html”.

- **Variables in tags** are used to capture dynamic values.
Example: Capture and apply the transaction value and products purchased to a conversion tag.

## Setup

Paste this code as high in the `<head>` of the page as possible:

```html
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T9DH8FJ');</script>
<!-- End Google Tag Manager -->
```

Additionally, paste this code immediately after the opening `<body>` tag:

```html
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T9DH8FJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
```

# Implement Tags via Google Tag Manager



## Track External Link Clicks



## Track Button Clicks

1. Trigger -> New -> Choose 'Click All Elements' type -> Some Clicks -> trigger condition 'Click Classes contains btn'
2. Tag -> Choose type 'Universal Analytics' -> Track Type 'Event' -> Category 'Button Click' -> Action 'Page Path' -> Label 'Click Text' -> Non-Interaction Hit 'True' -> GA Settings 'GA Tracking ID' -> Assign the Trigger
3. Preview
4. Publish

## Track Downloads as Virtual Page Views

1. Trigger -> New -> Choose type 'Click Just Links' -> Some Link Clicks -> trigger condition 'Click URL matches RegEx pdf|docx|xlsx'
2. Tag -> Choose type 'Universal Analytics' -> Track Type 'Page View' -> GA Settings 'GA Tracking ID' -> More Settings -> Field Name 'page' Value '/download/{{Click URL}}' -> Assign the Trigger
3. Preview
4. Publish

## Capture JavaScript Errors

1. Variables -> Configure: check all variables in 'Errors'
2. Trigger -> Choose type 'JavaScript Error' -> 
3. Tag -> Choose type 'Universal Analytics' -> Track Type 'Event' -> Category 'JavaScriptError' -> Action '{{Error Message}} Line No: {{Error Line}}' -> Label '{{Error URL}}' -> Non-Interaction Hit 'True' -> GA Settings 'GA Tracking ID' -> Assign the Trigger
4. Preview
5. Publish

## Use Data Layer with GTM

Data Layer is a **JavaScript object** that is used to pass information from your **website** to your **Tag Manager Container**. You can then use that information to populate variables and activate triggers in your tag configurations.

```javascript
<script>
  dataLayer = [{
    'key1':'value1',
    'key2':'value2',
    'key3':'value3'
  }];
</script>
```

1. Variables -> name the variable -> User-Defined Variables: NEW -> type: Data Layer Variable -> Name: key1 -> save
2. Variables -> name the variable -> User-Defined Variables: NEW -> type: Data Layer Variable -> Name: key2 -> save
3. Tags -> NEW -> name it: Data Layer Event Tag -> Choose type 'Universal Analytics' -> Track Type 'Event' -> Category 'Data Layer' -> Action '{{Listing Location}} -> Label '{{key1}}' -> Non-Interaction Hit 'True' -> GA Settings '{{GA Tracking ID}}' -> Assign the Trigger
4. Trigger -> All Pages
5. Preview
6. Publish

## Dynamic Data Addition in Data Layer & Use Custom Event in GTM

Add following new values to Data Layer when someone clicks on "Add To Cart" button:

`'Action': 'Add to Cart','ProductID': '123','event': 'addtocart',`

```javascript
onclick = dataLayer.push({
  'Action': 'Add To Favorite',
  'JobID': '123',
  'event': 'addtofavorite',
});
```

1. Variables -> User-Defined Variables: NEW -> type: Data Layer Variable -> Variable Name: Action -> Save
2.  Variables -> User-Defined Variables: NEW -> type: Data Layer Variable -> Variable Name: JobID -> Save
3.  Triggers -> NEW -> type: Custom Event -> Configuration: Event name: addtofavorite
4.  Tags -> NEW -> type: Universal Analytics -> Configuration: Track Type: Event, Category: DataLayerPush, Action: {{DataLayer-Action}} -> Label: {{DataLayer - JobID}} -> Non-Interaction Hit: True -> {{GA Tracking ID}}


<!--## Facebook Pixel with GTM-->

## Track Scroll Depth on Pages

As a site owner, you will always want to know if people are scrolling down to your content.

1. Variables -> Built-In Variables -> Scrolling Depth Threshold, Depth Units, Direction
2. Triggers -> type: User Engagement: Scroll Depth -> fires on: All Pages
3. Tags -> Universal Analytics -> Track Type: Event -> Category: Scroll Depth, Action: {{Page Path}}, Label: {{Scroll Depth Threshold}}

## Track if Users are Viewing a Particular Section, Image, Banner etc

1. Tags -> Universal Analytics -> Track Type: Event -> Category: Element Visibility -> Action: Agenda View -> Label: {{Page Path}}
2. Triggers -> **Element Visibility** -> Configuration: Selection Method: ID -> When to fire this trigger: Once per page  

## Track embedded YouTube Videos

1. Variables -> Built-In Variables -> Configure: Videos
2. Triggers -> type: Youtube 
3. Tags -> 

## Share Containers

- Exported as **JSON** file
- Exported containers can be: Modified, Shared, Stored externally, Imported back into Tag Manager

Admin -> Container: Export Container -> choose version or workplace 